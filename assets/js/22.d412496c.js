(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{472:function(s,t,n){"use strict";n.r(t);var e=n(2),a=Object(e.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"前言"}},[s._v("前言")]),s._v(" "),n("p",[s._v("其实，我博客写的很少了，相对来说，流水账笔记记的更多一点（"),n("a",{attrs:{href:"https://github.com/thyiad/learn",target:"_blank",rel:"noopener noreferrer"}},[s._v("笔记"),n("OutboundLink")],1),s._v("）。17年底研究docker的时候，顺便用docker搭建了wordpress，于是就有了这个网站。\n然而前段时间发现wordpress经常挂，docker log排查后，发现是因为mysql太吃内存，我这台1G1核的服务器带不动了。。。\n于是乎花了1天假期用vuepress+github page+travis ci重新搭建，此处简单记录一下")]),s._v(" "),n("h2",{attrs:{id:"vuepress"}},[s._v("vuepress")]),s._v(" "),n("p",[s._v("具体使用就不说了，"),n("a",{attrs:{href:"https://vuepress.vuejs.org/zh/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1),s._v("很详细。\n值得一提的是踩了一个坑：进入详情页后再F5刷新，此时会404。最后使用"),n("a",{attrs:{href:"https://vuepress.github.io/zh/plugins/dehydrate/#ssr-%E9%94%99%E9%85%8D",target:"_blank",rel:"noopener noreferrer"}},[s._v("vuepress-plugin-dehydrate"),n("OutboundLink")],1),s._v("这个官方插件解决了\n本质上vuepress是一个带有ssr的spa应用，ssr, spa都需要服务端的支持，但部署到github page显然是无服务端支持的，只能全部静态化解决。\n而这个插件，解决了ssr错配的问题，同时支持全部静态化。")]),s._v(" "),n("h2",{attrs:{id:"github-page"}},[s._v("github page")]),s._v(" "),n("p",[s._v("按照github要求，创建一个 [name].github.io仓库即可\n"),n("a",{attrs:{href:"https://help.github.com/cn/github/working-with-github-pages/getting-started-with-github-pages",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1)]),s._v(" "),n("h2",{attrs:{id:"travis-ci"}},[s._v("travis ci")]),s._v(" "),n("p",[s._v("步骤如下：")]),s._v(" "),n("ul",[n("li",[s._v("注册并开通travis，打开blog仓库的自动构建")]),s._v(" "),n("li",[s._v("blog仓库下创建.travis.yml文件, 我的完整命令如下"),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("language: node_js\nnode_js:\n- lts/*\ninstall:\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\nscript:\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run build\nafter_script:\n- "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" dist\n- "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'www.keepjs.com'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" CNAME\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" init\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("add")]),s._v(" -A\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" commit -m "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'deploy'")]),s._v("\n- "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" push -f "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https://'),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GITHUB_TOKEN}")]),s._v("@"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${GH_REF}")]),s._v('"')]),s._v(" master\nenv:\nglobal:\n    - GH_REF: github.com/Thyiad/thyiad.github.io.git\n    - secure: "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"uhAf/b6TBULEd7DEbT0ggtrZW4ZUW1FxZVlk6mKTpcYdm0Iz0jObLohUPbKxt0uC2Ud5Z1ZAepAuJoPMxf/Ten12s2MW3yp7iihCnLZhE1SHm31mvrv8v0TdcFFKlLPLK/KKh7l1xShJFTVvYyFQfO7dvxdcTCAYmDY3jobPpfAlLdtnWzPN7UijpA3uo/Jp5i+DsNtwVLJQHOfQcO948NILd20PwXY0CbYvNl7MsCtFcFZTxHXt5XTcbOTIpk874Q+6W/qzM95mWgtKSqKLJAjhx4tj6Nbksn7XtFggGP9x0n/EB1Kid8jvX3FZ71rvQwJuHWgXS4XJXKz7Fdl1zYfRlbGifPHpArKfzH7pvae09VvHKG6+gTY28bPeyY8PtWIwmiFLbJHNT6jeKCXpZU34IlIc4lvsT5hgftuqa2yPXCTltYTU4uWR7KhNFLcvsSaxcjFCfKZjGnwcwrTDgGEgJS9DIGprbbZ8t+DSgi3Rsxt/yeT8yzTxyB2ALr+AEc5d7m+Qt4spDcnTpTSPHZJIyRPgOE5VTGV4YxrndqDOJ+NlvqDczCl01XrNXpIlLn+0K4oS0PpoN2WQ6TG7S+BFsgiYglBMg2tuVlXwc9qWybmhx9VFjO9dFZxZQeCHlvnUpVQ8kG5AVz2Ur21WcovzV8hu9UAWNRQEh5YnJoU="')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br")])])])]),s._v(" "),n("p",[s._v("这里在监听到push代码后，执行了以下动作：")]),s._v(" "),n("ul",[n("li",[s._v("install 安装依赖")]),s._v(" "),n("li",[s._v("build 打包代码")]),s._v(" "),n("li",[s._v("把打包后的文件push到thyiad.github.io仓库")])]),s._v(" "),n("blockquote",[n("p",[s._v("推送到仓库需要在github的settings/Developer settings/Personnal access tokens中添加一条token\n使用 "),n("code",[s._v("travis encrypt -r 用户名/仓库 GITHUB_TOKEN=XXX")]),s._v(" 生成token，保证token只在这个仓库中能被解密使用，如果是在该仓库下面执行命令，则可以省略")])])])}),[],!1,null,null,null);t.default=a.exports}}]);