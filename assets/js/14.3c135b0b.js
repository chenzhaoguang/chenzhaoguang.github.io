(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{477:function(n,e,s){"use strict";s.r(e);var r=s(2),t=Object(r.a)({},(function(){var n=this,e=n.$createElement,s=n._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h2",{attrs:{id:"前言"}},[n._v("前言")]),n._v(" "),s("p",[n._v("前面有一篇文章已经写了如何搭建frp："),s("a",{attrs:{href:"https://www.keepjs.com/2018/03/01/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAfrp%E6%9C%8D%E5%8A%A1%E5%99%A8/",target:"_blank",rel:"noopener noreferrer"}},[n._v("使用docker搭建frp服务器"),s("OutboundLink")],1),n._v("，但对于ngrok这个用的最久的转发工具也忍不住想搭个试试，所以也就有了这篇文章。")]),n._v(" "),s("h2",{attrs:{id:"准备工作"}},[n._v("准备工作")]),n._v(" "),s("ul",[s("li",[n._v("ngrok客户端、服务端")])]),n._v(" "),s("blockquote",[s("p",[n._v("我没有自己编译，直接用的sunny编译好的ngrok客户端，已经全部放到了这里："),s("a",{attrs:{href:"https://github.com/Thyiad/tool/tree/master/ngrock/my-ngrok/server%20%26%20client",target:"_blank",rel:"noopener noreferrer"}},[n._v("github地址"),s("OutboundLink")],1)])]),n._v(" "),s("ul",[s("li",[n._v("具有外网ip的服务器")]),n._v(" "),s("li",[n._v("域名")])]),n._v(" "),s("blockquote",[s("p",[n._v("我这里用的是*.tunnel.keepjs.com，需要把这个域名解析到服务器上，具体的子域名在客户端配置，服务端配置前缀域名为tunnel.keepjs.com")])]),n._v(" "),s("ul",[s("li",[n._v("docker")])]),n._v(" "),s("blockquote",[s("p",[n._v("需要注意的是，我这里是基于ngin-proxy镜像来解析域名的，此处不再赘述，可参照之前的文章："),s("a",{attrs:{href:"https://www.keepjs.com/2018/02/28/%E4%BD%BF%E7%94%A8docker%E6%90%AD%E5%BB%BAwordpress/",target:"_blank",rel:"noopener noreferrer"}},[n._v("使用docker搭建wordpress"),s("OutboundLink")],1)])]),n._v(" "),s("h2",{attrs:{id:"docker-file"}},[n._v("docker file")]),n._v(" "),s("blockquote",[s("p",[n._v("镜像已经上传到docker的hub上了，所以你也可以跳过docker file直接使用compose")])]),n._v(" "),s("p",[n._v("创建工作目录与之前frp类似，dockerfile在这里就更简单了：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('FROM ubuntu\nMAINTAINER Thyiad <1520583107@qq.com>\n\nCOPY conf/ngrokd /ngrokd\n\nRUN chmod +x /ngrokd\n\nENTRYPOINT /ngrokd --domain="tunnel.keepjs.com"\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br")])]),s("p",[n._v("其实就是直接把conf下面的ngrok服务端复制过来，然后运行起来")]),n._v(" "),s("h2",{attrs:{id:"docker-compose"}},[n._v("docker compose")]),n._v(" "),s("p",[n._v("创建工作目录与之前frp类似，compose文件为以下内容：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("version: '3'\n\nservices:\n  ngrok:\n    image: thyiad/my-ngrok:latest\n    container_name: my-ngrok\n    ports:\n      - \"4443:4443\"\n    expose:\n      - 80\n      - 443\n    restart: always\n    environment:\n      VIRTUAL_HOST: '*.tunnel.keepjs.com,tunnel.keepjs.com'\n\nnetworks:\n  default:\n    external:\n      name: nginx-proxy\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br")])]),s("p",[n._v("运行我们的compose：")]),n._v(" "),s("div",{staticClass:"language-bash line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[n._v("docker-compose up -d\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[n._v("此时，我们的ngrok服务器就已经OK了。")]),n._v(" "),s("h2",{attrs:{id:"ngrok客户端"}},[n._v("ngrok客户端")]),n._v(" "),s("p",[n._v("服务端搭好之后，我们就可以使用客户端来进行使用了，解压对应的平台客户端，执行命令进行隧道连通。我这里是windows x64，执行以下命令：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("ngrok.exe -server_addr=tunnel.keepjs.com:4443 -subdomain=test -proto=http 52485\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[n._v("敲完回车后会出现以下界面：\n"),s("img",{attrs:{src:"https://static.yirenyian.com/blog/ngrok-running.png",alt:""}}),n._v("\n我们来访问test.tunnel.keepjs.com试试：\n"),s("img",{attrs:{src:"https://static.yirenyian.com/blog/ngrok-visible.png",alt:""}}),n._v("\nOK，现在就已经大功告成了！")]),n._v(" "),s("p",[n._v("以上文件已经上传到github：\n"),s("a",{attrs:{href:"https://github.com/Thyiad/docker",target:"_blank",rel:"noopener noreferrer"}},[n._v("https://github.com/Thyiad/docker"),s("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=t.exports}}]);